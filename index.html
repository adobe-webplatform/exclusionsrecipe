<!DOCTYPE html>
<!-- Copyright (c) 2013 Adobe Systems Incorporated. All rights reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License. -->
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Exclusions</title>
        <meta name="viewport" content="initial-scale=0.5,minimum-scale=0.5,maximum-scale=0.5,width=device-width,user-scalable=no">
        <link rel="stylesheet" href="overlock/stylesheet.css">
        <style media="screen">
            body {
                background: #333;
                margin: 0;
                padding: 0;
            }
            #content {
                background: #fff;
                width: 100%;
                min-width: 1000px;
                height: 100%;
                position: absolute;
                top: 0;
                left: 0;
                overflow: hidden;
                overflow-y: auto;
                font: 50px OverlockRegular;
            }
            #ing1,
            #ing2,
            #ing3 {
                position: fixed;
                background-size: cover;
            }
            #plate {
                position: absolute;
                top: -200px;
                left: 100%;
                margin-left: -300px;
                width: 400px;
                height: 400px;
                background-image: url(plate.jpg);
                background-size: cover;
            }
            #ing1 {
                bottom: 50px;
                left: 100px;
                width: 250px;
                height: 150px;
                background-image: url(garlic.jpg);
                background-position: 50% 50%;
                opacity: .5;
            }
            #ing2 {
                bottom: 200px;
                left: 400px;
                width: 150px;
                height: 150px;
                background-image: url(capsicum1.jpg);
                opacity: .5;
            }
            #ing3 {
                bottom: 350px;
                left: 400px;
                width: 100px;
                height: 100px;
                background-image: url(capsicum2.jpg);
                opacity: .4;
            }
            body.si .em,
            body.em .si {
                display: none;
            }
            h1 {
                position: absolute;
                top: 20px;
                left: 20px;
                font: 400 1.7em OverlockBold;
                margin: 0;
                padding: 0;
                white-space: nowrap;
            }
            #rate {
                position: absolute;
                top: 200px;
                left: 20px;
                font-size: .4em;
            }
            #steps {
                position: absolute;
                top: 0;
                left: 40%;
                margin-right: 100px;
                font-size: .35em;
            }
            #steps ol {
                margin-left: 70px;
            }
            #steps p {
                margin: 0;
                padding: 0 0 10px 0;
            }
            #steps span {
                color: #c00;
            }
            #ingredients {
                font-size: .35em;
                position: absolute;
                top: 0;
                left: 20px;
                width: 40%;
            }
            h2 {
                margin: 140px 0 40px;
                padding: 0;
                font-size: 40px;
                font-family: OverlockSCRegular;
                color: #c30;
            }
            #ingredients h3 {
                padding: 20px 0 40px;
                margin: 0;
                clear: both;
            }
            #ingredients dl {
                float: left;
                margin: 0;
            }
            #ingredients dt {
                clear: left;
                width: 7em;
            }
            #ingredients dd,
            #ingredients dt {
                float: left;
                margin-right: .25em;
            }
            h2 {
                clear: both;
            }
            svg {
                position: absolute;
                left: 40%;
                top: 0px;
                display: none;
            }
            @media only screen and (min-width: 1600px) and (min-height: 2000px) {
                #content {
                    font: 100px OverlockRegular;
                    width: 1600px;
                    height: 2240px;
                }
                #plate {
                    top: 200px;
                    left: 1000px;
                    width: 800px;
                    height: 800px;
                    margin: 0;
                }
                h1 {
                    width: 100%;
                    text-align: center;
                }
                #steps {
                    top: 300px;
                    left: 600px;
                    width: 800px;
                    font-size: .35em;
                }
                #ingredients {
                    top: 300px;
                }
                #steps,
                #ingredients {
                    font-size: .4em;
                }
                #ing1 {
                    width: 500px;
                    height: 300px;
                }
                #ing2 {
                    width: 300px;
                    height: 300px;
                }
                #ing3 {
                    width: 200px;
                    height: 200px;
                }
            }
            @media only screen and (min-width: 1224px) and (orientation: portrait) {
                #content {
                    font-size: 60px;
                    width: 100%;
                    height: 100%;
                    overflow-y: auto;
                }
                #rate {
                    display: none;
                }
                h2 {
                    font-size: 50px;
                }
                #steps,
                #ingredients {
                    top: 30px;
                }
                #steps {
                    left: 0;
                    width: 100%;
                }
                #steps p,
                #steps h2 {
                    margin-left: 600px;
                }
                #ing1 {
                    position: fixed;
                    bottom: 50px;
                    left: 100px;
                    width: 200px;
                    height: 150px;
                }
                #ing2 {
                    position: fixed;
                    bottom: 200px;
                    left: 300px;
                    width: 150px;
                    height: 150px;
                }
                #ing3 {
                    position: fixed;
                    bottom: 400px;
                    left: 400px;
                    width: 150px;
                    height: 150px;
                }
                #plate {
                    top: 200px;
                    left: auto;
                    margin: 0;
                    right: -100px;
                    width: 400px;
                    height: 400px;
                }
            }
        </style>
    </head>
    <body class="em">
        <div id="content">
            <div id="plate"></div>
            <div id="ing1"></div>
            <div id="ing2"></div>
            <div id="ing3"></div>
            <h1>Chicken Roll with Capsicum</h1>
            <div id="cake-side"></div>
            <div id="ingredients">
                <h2>Ingredients</h2>
                <dl>
                    <dt>Chicken fillets</dt>
                    <dd>2</dd>
                    <dt>Bacon</dt>
                    <dd>10</dd>
                    <dt>Mozzarella</dt>
                    <dd class="si">80 g</dd>
                    <dd class="em">2½ oz</dd>
                    <dt>Red capsicum</dt>
                    <dd>1</dd>
                    <dt>Yellow capsicum</dt>
                    <dd>1</dd>
                    <dt>Garlic</dt>
                    <dd>1 tooth</dd>
                    <dt>Oil</dt>
                    <dd>2 tbspoons</dd>
                    <dt>Oregano</dt>
                    <dd>1 tspoon</dd>
                    <dt>Parsley</dt>
                    <dd>medium bunch</dd>
                    <dt>Pepper</dt>
                    <dt>Salt</dt>
                </dl>
            </div>
            <div id="steps">
                <h2>Directions</h2>
                <!-- <OL> is buggy, when exclusion applied -->
                <p><span>&#9312;</span> Cook capsicums in the oven at
                    <span class="si">190°C</span><span class="em">375°F</span>
                    for 30 minutes. Constantly turn them, so they cook from each
                    side.</p>
                <p><span>&#9313;</span> Put capsicums into plastic bag and leave
                    for 10 minutes. Peel the skin and cut in slices.</p>
                <p><span>&#9314;</span> Beat up fillets to give them as much
                    rectangle-like form as you can.</p>
                <p><span>&#9315;</span> Place 5 pieces of bacon a wooden board
                    side by side with an overlap. Square of the bacon’s rag
                    should be slightly bigger than beaten fillet. Place fillet
                    on the bacon.</p>
                <p><span>&#9316;</span> Add salt, pepper, oil and crashed
                    garlic.</p>
                <p><span>&#9317;</span> Spray with oregano and chopped parsley.
                    Place red and yellow capsicum and dices of cheese.</p>
                <p><span>&#9318;</span> Wrap in a roll and tight with a thread.
                </p>
                <p><span>&#9319;</span> Repeat with another fillet.</p>
                <p><span>&#9320;</span> Heat oil on frying pan and roast rolls
                    until golden.</p>
                <p><span>&#9321;</span> Place rolls in a tray and put into
                    preheat to
                    <span class="si">200°C</span><span class="em">390°F</span>
                    oven for 15 min.</p>
                <p><span>&#9322;</span> Serve cold.</p>
            </div>
        </div>
        <svg>
            <path id="path" fill-opacity=".3"/>
        </svg>
        <script>
            function getPolygon(p) {
                var l = p.getTotalLength(),
                    res = [];
                for (var i = 0; i < l; i += 40) {
                    var dot = p.getPointAtLength(i);
                    res.push(~~dot.x + "px " + ~~dot.y + "px");
                }
                return res.join();
            }
            function sub(x, y, w, h, cx, cy, r) {
                function dist(x, y, x2, y2) {
                    return    Math.sqrt(Math.pow(x2 - x, 2) +
                            Math.pow(y2 - y, 2));
                }
                var big = cx < x + w && cx > x && cy > y && cy < y + h;
                function getXY(xy) {
                    var out;
                    if ("y" in xy) {
                        var Y = xy.y,
                            D = 4 * cx * cx -
                                4 * (cx * cx + Math.pow(Y - cy, 2) - r * r);
                        if (D >= 0) {
                            out = [
                                (2 * cx + Math.sqrt(D)) / 2,
                                (2 * cx - Math.sqrt(D)) / 2
                            ];
                            (out[1] >= x + w || out[1] <= x) && out.pop();
                            (out[0] >= x + w || out[0] <= x) && out.shift();
                            return out.length ? out : null;
                        } else {
                            return null;
                        }
                    } else {
                        var X = xy.x;
                        D = 4 * cy * cy -
                            4 * (cy * cy + Math.pow(X - cx, 2) - r * r);
                        if (D >= 0) {
                            out = [
                                (2 * cy + Math.sqrt(D)) / 2,
                                (2 * cy - Math.sqrt(D)) / 2
                            ];
                            (out[1] >= y + h || out[1] <= y) && out.pop();
                            (out[0] >= y + h || out[0] <= y) && out.shift();
                            return out.length ? out : null;
                        } else {
                            return null;
                        }
                    }
                }
                function getPath() {
                    function run(xy, mid, mid2, end, dir) {
                        if (xy) {
                            if (xy.length - 1) {
                                if (!dir) {
                                    var t = mid;
                                    mid = mid2;
                                    mid2 = t;
                                }
                                res +=    "L" + mid2 +
                                        "A" + [r, r, 0, +big, 0].concat(mid) +
                                        "L" + end;
                            } else {
                                if (out) {
                                    res += "L" + mid;
                                } else {
                                    res +=
                                        "A" + [r, r, 0, 0, 0].concat(mid) +
                                        "L" + end;
                                }
                                out = !out;
                            }
                        } else if (out) {
                            res += "L" + end;
                        }
                    }
                    var out = true,
                        res = "",
                        points = [
                            [x, y, "y"],
                            [x + w, y, "x"],
                            [x + w, y + h, "y"],
                            [x, y + h, "x"]
                        ],
                        fs = {
                            x: function (i) {
                                var p = points[i];
                                xy = getXY({x: p[0]});
                                mid = xy && [p[0], xy[0]];
                                mid2 = xy && [p[0], xy[1]];
                                var next = points[i + 1] || points[0];
                                end = [next[0], next[1]];
                                run(xy, mid, mid2, end, p[1] < next[1]);
                            },
                            y: function (i) {
                                var p = points[i];
                                xy = getXY({y: p[1]});
                                mid = xy && [xy[0], p[1]];
                                mid2 = xy && [xy[1], p[1]];
                                var next = points[i + 1] || points[0];
                                end = [next[0], next[1]];
                                run(xy, mid, mid2, end, p[0] < next[0]);
                            }
                        },
                        xy, mid, mid2, end, cornerIn, shifted;
                    for (var j = 0; j < points.length; j++) {
                        var p = points[0];
                        if (dist(p[0], p[1], cx, cy) > r) {
                            res = "M" + [p[0], p[1]];
                            break;
                        } else {
                            points.push(points.shift());
                        }
                    }
                    if (!res) {
                        return "M0,0";
                    }
                    for (j = 0; j < points.length; j++) {
                        fs[points[j][2]](j);
                    }
                    return res + "z";
                }
                return getPath();
            }
            var p = document.getElementById("path"),
                steps = document.getElementById("steps"),
                plate = document.getElementById("plate"),
                ing = [
                    document.getElementById("ing1"),
                    document.getElementById("ing2"),
                    document.getElementById("ing3")
                ];
            function spread(val01, start, end) {
                return start + (end - start) * val01;
            }
            function bit() {
                bit.bit = bit.bit || 0;
                bit.bit++;
                if (bit.bit > 10) {
                    bit.bit = 0;
                }
                return bit.bit;
            }
            function desktop() {
                var W = document.body.offsetWidth;
                p.setAttribute("d", sub(0, 140, steps.offsetWidth,
                    steps.offsetHeight, W - 100 - W * .4, 240, 200));
                steps.style.WebkitShapeInside =
                    "polygon(" + getPolygon(p) + ")";
                steps.style.borderBottom = "solid " + bit() + "px #fff";
                plate.style.top = "40px";
                desktop = null;
            }
            function plateUpdate(b, g) {
                var o = window.orientation;
                if (o == 180 || o == 90) {
                    b = -b;
                    g = -g;
                }
                if (o == 0 || o == 180) {
                    p.setAttribute("d", sub(0, 0, 1450, 1320, 1460,
                        spread((b + 90) / 180, 60, 940), 400));
                    steps.style.WebkitShapeInside =
                        "polygon(" + getPolygon(p) + ")";
                    steps.style.width = 1450 + bit() + "px";
                    plate.style.top = spread((b + 90) / 180, -200, 680) + "px";
                    ing[0].style.marginLeft = Math.round(g * 4) + "px";
                    ing[1].style.marginLeft = Math.round(g) + "px";
                    ing[2].style.marginLeft = Math.round(g / 4) + "px";
                } else {
                    if (window.innerWidth < 1590 &&
                        screen.width > screen.height) {
                        desktop && desktop();
                        b = spread(b / window.innerWidth, -45, 45);
                        ing[0].style.marginLeft = Math.round(b * 4) + "px";
                        ing[1].style.marginLeft = Math.round(b) + "px";
                        ing[2].style.marginLeft = Math.round(b / 4) + "px";
                    } else {
                        p.setAttribute("d", sub(0, 0, 800, 1940, 800,
                            spread((g + 90) / 180, 100, 1440), 400));
                        steps.style.WebkitShapeInside =
                            "polygon(" + getPolygon(p) + ")";
                        steps.style.width = 980 + bit() + "px";
                        plate.style.top = spread((g + 90) / 180, 0, 1340) +
                            "px";
                        ing[0].style.marginLeft = Math.round(b * 4) + "px";
                        ing[1].style.marginLeft = Math.round(b) + "px";
                        ing[2].style.marginLeft = Math.round(b / 4) + "px";
                    }
                }
            }
            window.addEventListener("deviceorientation", function (event) {
                plateUpdate(event.beta, event.gamma);
            }, true);
            window.addEventListener("mousemove", function (event) {
                plateUpdate(event.pageX, -90);
            }, true);
        </script>
    </body>
</html>
